# Audit_of_logins_sql_server

# Login_Audit.sql
1. Создает сеанс расширенных событий [Audit_Logon], которая отслеживает события - логин
2. Создает таблицы в master, для обработки и хранения логинов.
3. Создает в master процедуру sp_ConsolidateAuditLogin, которая обрабатывает и группирует логины.
4. Создает в master процедуру sp_LoginDisabling. Процедура отключает логины, которыми не пользовались последние 90 дней.


# capture_logon_events.ps1
Скрипт powershell, который передает события, отловленные в сеансе [Audit_Logon] и отправляет их в стейджинг в master.
p.s. скрипт сохранял в корне диска C, если изменить место расположения файла не забыть прописать это в скрипте для создания заданий.


# Login_Audit_Schedulers.sql
Скрипт создает задания, выполняющие все описаные выше обработки.
1. Создает задание logins_audit1, которое выполняет скрипт powershell. (Прописать запуск при старте SQLAgent)
2. Создает задание logins_audit2, которое вызывает пройцедуру sp_ConsolidateAuditLogin, для сбора и консолидации данных по логинам. (Установлен запуск каждые 5 минут)
3. Создает задание logins_disabling, которое вызывает процедуру sp_LoginDisabling, отключающую устаревшие логины. (Установлен запуск в 01:00 каждый день)
